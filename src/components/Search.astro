---
const isDev = import.meta.env.DEV;
---

<div id="search"></div>

<style>
  #search {
    flex: 1;
    max-width: 300px;
  }

  @media (max-width: 768px) {
    #search {
      max-width: 200px;
    }
  }

  @media (max-width: 480px) {
    #search {
      flex: 1;
      max-width: none;
      order: 2;
    }
  }
</style>

<script is:inline define:vars={{ isDev }}>
  // 開発モードでは pagefind を読み込まない
  if (isDev) {
    const searchElement = document.getElementById('search');
    if (searchElement) {
      searchElement.style.display = 'none';
    }
  } else {
    // Pagefind UI の CSS を動的に読み込み
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/pagefind/pagefind-ui.css';
    document.head.appendChild(link);

    // Pagefind UI の JS を動的に読み込み
    const script = document.createElement('script');
    script.src = '/pagefind/pagefind-ui.js';
    script.onload = () => {
      new window.PagefindUI({
        element: '#search',
        showSubResults: true,
        showImages: false,
        excerptLength: 15,
        translations: {
          placeholder: 'サイト内を検索',
          clear_search: 'クリア',
          load_more: 'さらに読み込む',
          search_label: 'サイト内検索',
          filters_label: 'フィルター',
          zero_results: '検索結果が見つかりませんでした: [SEARCH_TERM]',
          many_results: '[COUNT] 件の結果が見つかりました: [SEARCH_TERM]',
          one_result: '1 件の結果が見つかりました: [SEARCH_TERM]',
          alt_search: '[SEARCH_TERM] の検索結果はありませんでした。代わりに [DIFFERENT_TERM] を検索しています',
          search_suggestion: '検索候補はありませんでした。別のキーワードで検索してください',
          searching: '検索中...',
        },
      });
    };
    script.onerror = () => {
      console.warn('Pagefind の読み込みに失敗しました');
    };
    document.head.appendChild(script);
  }
</script>
